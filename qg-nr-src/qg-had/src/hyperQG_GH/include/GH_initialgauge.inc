
!---given the metric, their first derivatives and the extrinsic curvature-------

       g00 = g_e(0,0)
       g01 = g_e(0,1)
       g02 = g_e(0,2)
       g03 = g_e(0,3)
       g11 = g_e(1,1)
       g12 = g_e(1,2)
       g13 = g_e(1,3)
       g22 = g_e(2,2)
       g23 = g_e(2,3)
       g33 = g_e(3,3)
                          
       D100 = dg_e(1,0,0)
       D101 = dg_e(1,0,1)
       D102 = dg_e(1,0,2)
       D103 = dg_e(1,0,3)
       D111 = dg_e(1,1,1)
       D112 = dg_e(1,1,2)
       D113 = dg_e(1,1,3)
       D122 = dg_e(1,2,2)
       D123 = dg_e(1,2,3)
       D133 = dg_e(1,3,3)
       
       D200 = dg_e(2,0,0)
       D201 = dg_e(2,0,1)
       D202 = dg_e(2,0,2)
       D203 = dg_e(2,0,3)
       D211 = dg_e(2,1,1)
       D212 = dg_e(2,1,2)
       D213 = dg_e(2,1,3)
       D222 = dg_e(2,2,2)
       D223 = dg_e(2,2,3)
       D233 = dg_e(2,3,3)

       D300 = dg_e(3,0,0)
       D301 = dg_e(3,0,1)
       D302 = dg_e(3,0,2)
       D303 = dg_e(3,0,3)
       D311 = dg_e(3,1,1)
       D312 = dg_e(3,1,2)
       D313 = dg_e(3,1,3)
       D322 = dg_e(3,2,2)
       D323 = dg_e(3,2,3)
       D333 = dg_e(3,3,3)

!------the 3D extrinsic curvature is set in exact---------       
       eK11 = K_e(1,1)
       eK12 = K_e(1,2)
       eK13 = K_e(1,3)
       eK22 = K_e(2,2)
       eK23 = K_e(2,3)
       eK33 = K_e(3,3)
                     
!-----the 3+1 quantities----------------------------------------------------
       
       h11 = g11
       h12 = g12
       h13 = g13
       h22 = g22
       h23 = g23
       h33 = g33
                                          
       huu11 = -h23**2 + h22*h33
       huu12 = h13*h23 - h12*h33
       huu13 = -(h13*h22) + h12*h23
       huu22 = -h13**2 + h11*h33
       huu23 = h12*h13 - h11*h23
       huu33 = -h12**2 + h11*h22
       deth = h11*huu11 + h12*huu12 + h13*huu13
       if(deth.lt.1e-1) deth=1e-1
       huu11 = huu11/deth
       huu12 = huu12/deth
       huu13 = huu13/deth
       huu22 = huu22/deth
       huu23 = huu23/deth
       huu33 = huu33/deth

       b1 = g01*huu11 + g02*huu12 + g03*huu13
       b2 = g01*huu12 + g02*huu22 + g03*huu23
       b3 = g01*huu13 + g02*huu23 + g03*huu33
       alp2 = -g00 + b1**2*h11 + b2**2*h22 + 2*(b1*(b2*h12 + b3*h13) &
     &      + b2*b3*h23) + b3**2*h33
       if(alp2.lt.0.01) alp2=0.01
       alp = sqrt(alp2)

!----- the 4D stuff ------------------------------------------------

       guu00 = -(1.0d0/alp2)
       guu01 = b1/alp2
       guu02 = b2/alp2
       guu03 = b3/alp2
       guu11 = -(b1**2/alp2) + huu11
       guu12 = -((b1*b2)/alp2) + huu12
       guu13 = -((b1*b3)/alp2) + huu13
       guu22 = -(b2**2/alp2) + huu22
       guu23 = -((b2*b3)/alp2) + huu23
       guu33 = -(b3**2/alp2) + huu33

       D011 = - 2.0*alp*eK11 + (b1*D111 + b2*D211 + b3*D311) + D101 + D101 &
           & - ( b1*(D111 + D111) + b2*(D112 + D112) + b3*(D113 + D113) )
       D012 = - 2.0*alp*eK12 + (b1*D112 + b2*D212 + b3*D312) + D102 + D201 &
           & - ( b1*(D112 + D211) + b2*(D122 + D212) + b3*(D123 + D213) )
       D013 = - 2.0*alp*eK13 + (b1*D113 + b2*D213 + b3*D313) + D103 + D301 &
           & - ( b1*(D113 + D311) + b2*(D123 + D312) + b3*(D133 + D313) )
       D022 = - 2.0*alp*eK22 + (b1*D122 + b2*D222 + b3*D322) + D202 + D202 &
           & - ( b1*(D212 + D212) + b2*(D222 + D222) + b3*(D223 + D223) )
       D023 = - 2.0*alp*eK23 + (b1*D123 + b2*D223 + b3*D323) + D203 + D302 &
           & - ( b1*(D213 + D312) + b2*(D223 + D322) + b3*(D233 + D323) )
       D033 = - 2.0*alp*eK33 + (b1*D133 + b2*D233 + b3*D333) + D303 + D303 &
           & - ( b1*(D313 + D313) + b2*(D323 + D323) + b3*(D333 + D333) )

       if (initial_H .EQ. 0) then

         H0 = 0.0; H1 = 0.0; H2 = 0.0; H3 = 0.0

         D000 = (guu11*(D011 - 2.*D101) + guu22*(D022 -&
        & 2.*D202) + 2.*(guu12*D012 + guu13*D013 + guu23*D023 -&
        & guu01*D100 - guu02*D200 - guu12*(D102 + D201) -&
        & guu03*D300 - guu13*(D103 + D301) - guu23*(D203 +&
        & D302)) + guu33*(D033 - 2.*D303))/guu00 - Z0/guu00

         D001 = D100/2. + ((-(guu11*D111) + guu22*D122 + guu33*D133)/2.&
        & - guu12*D211 - guu22*D212 - guu13*D311 + guu23*(D123 - D213 - D312)&
        & - guu33*D313 - guu01*D011 - guu03*D013 + guu02*D102 -&
        & guu02*(D012 + D201) + guu03*(D103 - D301))/guu00

         D002 = D200/2. + (-(guu11*D112) - guu12*D122 - guu13*D123 -&
        & (guu22*D222)/2. + (guu11*D211 + guu33*D233)/2. + guu13*(D213 - D312)&
        & - guu23*D322 - guu33*D323 - guu02*D022 - guu01*(D012 +&
        & D102) + guu01*D201 + guu03*D203 - guu03*(D023 + D302))/guu00

         D003 = D300/2. + (-(guu11*D113) - guu13*D133 - guu12*(D123 +&
        & D213) - guu22*D223 - guu23*D233 + guu12*D312 + (guu11*D311 +&
        & guu22*D322)/2. - (guu33*D333)/2. - guu03*D033 - guu01*(D013 +&
        & D103) - guu02*(D023 + D203) + guu01*D301 + guu02*D302)/guu00

       else

         D000 = 0.0; D001 = 0.0; D002 = 0.0; D003 = 0.0

         G000 = D000/2.
         G001 = D100/2.
         G002 = D200/2.
         G003 = D300/2.
         G011 = -D011/2. + D101
         G012 = (-D012 + D102 + D201)/2.
         G013 = (-D013 + D103 + D301)/2.
         G022 = -D022/2. + D202
         G023 = (-D023 + D203 + D302)/2.
         G033 = -D033/2. + D303
         G100 = D001 - D100/2.
         G101 = D011/2.
         G102 = (D012 - D102 + D201)/2.
         G103 = (D013 - D103 + D301)/2.
         G111 = D111/2.
         G112 = D211/2.
         G113 = D311/2.
         G122 = -D122/2. + D212
         G123 = (-D123 + D213 + D312)/2.
         G133 = -D133/2. + D313
         G200 = D002 - D200/2.
         G201 = (D012 + D102 - D201)/2.
         G202 = D022/2.
         G203 = (D023 - D203 + D302)/2.
         G211 = D112 - D211/2.
         G212 = D122/2.
         G213 = (D123 - D213 + D312)/2.
         G222 = D222/2.
         G223 = D322/2.
         G233 = -D233/2. + D323
         G300 = D003 - D300/2.
         G301 = (D013 + D103 - D301)/2.
         G302 = (D023 + D203 - D302)/2.
         G303 = D033/2.
         G311 = D113 - D311/2.
         G312 = (D123 + D213 - D312)/2.
         G313 = D133/2.
         G322 = D223 - D322/2.
         G323 = D233/2.
         G333 = D333/2.

         trG0 = guu00*G000 + guu11*G011 + guu22*G022 + guu33*G033 &
      &   +2.0*(guu01*G001 + guu02*G002 + guu03*G003 +&
      &         guu12*G012 + guu13*G013 + guu23*G023) 

         trG1 = guu00*G100 + guu11*G111 + guu22*G122 + guu33*G133 &
      &   +2.0*(guu01*G101 + guu02*G102 + guu03*G103 +&
      &         guu12*G112 + guu13*G113 + guu23*G123) 

         trG2 = guu00*G200 + guu11*G211 + guu22*G222 + guu33*G233 &
      &   +2.0*(guu01*G201 + guu02*G202 + guu03*G203 +&
      &         guu12*G212 + guu13*G213 + guu23*G223) 

         trG3 = guu00*G300 + guu11*G311 + guu22*G322 + guu33*G333 &
      &   +2.0*(guu01*G301 + guu02*G302 + guu03*G303 +&
      &         guu12*G312 + guu13*G313 + guu23*G323) 

         H0 = - trG0 - 2*Z0
         H1 = - trG1 - 2*Z1
         H2 = - trG2 - 2*Z2
         H3 = - trG3 - 2*Z3
	 
      end if

!-----we have Hs and D0ab, let us compute the evolved variable K------------

      K00 = -( D000 - (b1*D100 + b2*D200 + b3*D300) )/alp
      K01 = -( D001 - (b1*D101 + b2*D201 + b3*D301) )/alp
      K02 = -( D002 - (b1*D102 + b2*D202 + b3*D302) )/alp
      K03 = -( D003 - (b1*D103 + b2*D203 + b3*D303) )/alp
      K11 = -( D011 - (b1*D111 + b2*D211 + b3*D311) )/alp
      K12 = -( D012 - (b1*D112 + b2*D212 + b3*D312) )/alp
      K13 = -( D013 - (b1*D113 + b2*D213 + b3*D313) )/alp
      K22 = -( D022 - (b1*D122 + b2*D222 + b3*D322) )/alp
      K23 = -( D023 - (b1*D123 + b2*D223 + b3*D323) )/alp
      K33 = -( D033 - (b1*D133 + b2*D233 + b3*D333) )/alp

