        call deriv_x(q(dx_chi),chi,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_chi),chi,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_chi),chi,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Gamtx),Gamtx,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Gamtx),Gamtx,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Gamtx),Gamtx,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Gamty),Gamty,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Gamty),Gamty,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Gamty),Gamty,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Gamtz),Gamtz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Gamtz),Gamtz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Gamtz),Gamtz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_trK),trK,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_trK),trK,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_trK),trK,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_gtxx),gtxx,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_gtxx),gtxx,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_gtxx),gtxx,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_gtxy),gtxy,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_gtxy),gtxy,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_gtxy),gtxy,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_gtxz),gtxz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_gtxz),gtxz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_gtxz),gtxz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_gtyy),gtyy,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_gtyy),gtyy,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_gtyy),gtyy,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_gtyz),gtyz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_gtyz),gtyz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_gtyz),gtyz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_gtzz),gtzz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_gtzz),gtzz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_gtzz),gtzz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Atxx),Atxx,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Atxx),Atxx,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Atxx),Atxx,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Atxy),Atxy,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Atxy),Atxy,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Atxy),Atxy,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Atxz),Atxz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Atxz),Atxz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Atxz),Atxz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Atyy),Atyy,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Atyy),Atyy,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Atyy),Atyy,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Atyz),Atyz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Atyz),Atyz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Atyz),Atyz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Atzz),Atzz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Atzz),Atzz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Atzz),Atzz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Ex),Ex,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Ex),Ex,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Ex),Ex,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Ey),Ey,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Ey),Ey,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Ey),Ey,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Ez),Ez,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Ez),Ez,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Ez),Ez,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Bx),Bx,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Bx),Bx,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Bx),Bx,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_By),By,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_By),By,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_By),By,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Bz),Bz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Bz),Bz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Bz),Bz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_phiR),phiR,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_phiR),phiR,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_phiR),phiR,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_phiI),phiI,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_phiI),phiI,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_phiI),phiI,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_piR),piR,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_piR),piR,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_piR),piR,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_piI),piI,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_piI),piI,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_piI),piI,dz, nx, ny, nz, d_type)
        call deriv_xx(q(dxx_gtxx),gtxx,dx, nx, ny, nz, dd_type)
        call deriv_yy(q(dyy_gtxx),gtxx,dy, nx, ny, nz, dd_type)
        call deriv_zz(q(dzz_gtxx),gtxx,dz, nx, ny, nz, dd_type)
        call deriv_y(q(dxy_gtxx),q(dx_gtxx),dy, nx, ny, nz, d_type)
        call deriv_z(q(dxz_gtxx),q(dx_gtxx),dz, nx, ny, nz, d_type)
        call deriv_z(q(dyz_gtxx),q(dy_gtxx),dz, nx, ny, nz, d_type)
        call deriv_xx(q(dxx_gtxy),gtxy,dx, nx, ny, nz, dd_type)
        call deriv_yy(q(dyy_gtxy),gtxy,dy, nx, ny, nz, dd_type)
        call deriv_zz(q(dzz_gtxy),gtxy,dz, nx, ny, nz, dd_type)
        call deriv_y(q(dxy_gtxy),q(dx_gtxy),dy, nx, ny, nz, d_type)
        call deriv_z(q(dxz_gtxy),q(dx_gtxy),dz, nx, ny, nz, d_type)
        call deriv_z(q(dyz_gtxy),q(dy_gtxy),dz, nx, ny, nz, d_type)
        call deriv_xx(q(dxx_gtxz),gtxz,dx, nx, ny, nz, dd_type)
        call deriv_yy(q(dyy_gtxz),gtxz,dy, nx, ny, nz, dd_type)
        call deriv_zz(q(dzz_gtxz),gtxz,dz, nx, ny, nz, dd_type)
        call deriv_y(q(dxy_gtxz),q(dx_gtxz),dy, nx, ny, nz, d_type)
        call deriv_z(q(dxz_gtxz),q(dx_gtxz),dz, nx, ny, nz, d_type)
        call deriv_z(q(dyz_gtxz),q(dy_gtxz),dz, nx, ny, nz, d_type)
        call deriv_xx(q(dxx_gtyy),gtyy,dx, nx, ny, nz, dd_type)
        call deriv_yy(q(dyy_gtyy),gtyy,dy, nx, ny, nz, dd_type)
        call deriv_zz(q(dzz_gtyy),gtyy,dz, nx, ny, nz, dd_type)
        call deriv_y(q(dxy_gtyy),q(dx_gtyy),dy, nx, ny, nz, d_type)
        call deriv_z(q(dxz_gtyy),q(dx_gtyy),dz, nx, ny, nz, d_type)
        call deriv_z(q(dyz_gtyy),q(dy_gtyy),dz, nx, ny, nz, d_type)
        call deriv_xx(q(dxx_gtyz),gtyz,dx, nx, ny, nz, dd_type)
        call deriv_yy(q(dyy_gtyz),gtyz,dy, nx, ny, nz, dd_type)
        call deriv_zz(q(dzz_gtyz),gtyz,dz, nx, ny, nz, dd_type)
        call deriv_y(q(dxy_gtyz),q(dx_gtyz),dy, nx, ny, nz, d_type)
        call deriv_z(q(dxz_gtyz),q(dx_gtyz),dz, nx, ny, nz, d_type)
        call deriv_z(q(dyz_gtyz),q(dy_gtyz),dz, nx, ny, nz, d_type)
        call deriv_xx(q(dxx_gtzz),gtzz,dx, nx, ny, nz, dd_type)
        call deriv_yy(q(dyy_gtzz),gtzz,dy, nx, ny, nz, dd_type)
        call deriv_zz(q(dzz_gtzz),gtzz,dz, nx, ny, nz, dd_type)
        call deriv_y(q(dxy_gtzz),q(dx_gtzz),dy, nx, ny, nz, d_type)
        call deriv_z(q(dxz_gtzz),q(dx_gtzz),dz, nx, ny, nz, d_type)
        call deriv_z(q(dyz_gtzz),q(dy_gtzz),dz, nx, ny, nz, d_type)
        call deriv_xx(q(dxx_chi),chi,dx, nx, ny, nz, dd_type)
        call deriv_yy(q(dyy_chi),chi,dy, nx, ny, nz, dd_type)
        call deriv_zz(q(dzz_chi),chi,dz, nx, ny, nz, dd_type)
        call deriv_y(q(dxy_chi),q(dx_chi),dy, nx, ny, nz, d_type)
        call deriv_z(q(dxz_chi),q(dx_chi),dz, nx, ny, nz, d_type)
        call deriv_z(q(dyz_chi),q(dy_chi),dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Ex),Ex,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Ex),Ex,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Ex),Ex,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Ey),Ey,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Ey),Ey,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Ey),Ey,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Ez),Ez,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Ez),Ez,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Ez),Ez,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Bx),Bx,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Bx),Bx,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Bx),Bx,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_By),By,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_By),By,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_By),By,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_Bz),Bz,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_Bz),Bz,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_Bz),Bz,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_phiR),phiR,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_phiR),phiR,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_phiR),phiR,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_phiI),phiI,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_phiI),phiI,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_phiI),phiI,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_piR),piR,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_piR),piR,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_piR),piR,dz, nx, ny, nz, d_type)
        call deriv_x(q(dx_piI),piI,dx, nx, ny, nz, d_type)
        call deriv_y(q(dy_piI),piI,dy, nx, ny, nz, d_type)
        call deriv_z(q(dz_piI),piI,dz, nx, ny, nz, d_type)
